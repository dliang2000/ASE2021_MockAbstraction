\section{Introduction}
\label{sec:introduction}

Mock objects ~\cite{beck02:_test_driven_devel} are a common idiom in
unit tests for object-oriented systems.  They allow developers to test objects that 
rely on other objects, likely from different components, or are simply complicated 
to build for testing purposes (e.g. a database).

While mock objects are an invaluable tool for developers, their use
complicates the static analysis of test cases. 
By design, a call to a mock object resembles a call to the real object. 
A naive static analysis attempting to be sound will have to include all of 
the possible behaviours of the actual object when analysing such code. 
As a result, such analysis would be useless in capturing the true behaviour 
of the test case.

Others have defined the notion of a focal method for a test case---the method
whose behaviour is being tested. ~\cite{7335402}
The test case would set up mock objects to provide parameters to this focal method.
When analyzing the test case, it would be useful to know which variables in the
method contain mock objects, in order to build a more precise call graph and get 
better insight of the overall project.

We have designed a helper static analysis, \textsc{MockDetector}, which identifies
mock objects in test cases. It starts from a list of mock object creation sites; we
have provided APIs for the common mocking libraries. It then propagates the mockiness
intraprocedurally through a forward flow must analysis and to containers, so that an analysis
can ask whether a given variable in a test case contains a mock or not. Currently, we have
evaluated \textsc{MockDetector} on a suite of 3 benchmarks. Manual inspection have shown 
correct intraprocedural mock detection over the benchmarks. 

Taking a broader view, we believe that helper static analyses can aid
in the development of more useful static analyses. These analyses can
encode useful domain properties; for instance, in our case, properties
of test cases. By taking a domain-specific approach, analyses can extract
useful facts about programs that would otherwise be difficult to establish.

We make the following main contributions in this paper:

1) We designed and implemented \textsc{MockDetector}, a forward flow must analysis technique to help identifying variables that are mock objects, along with a special-case support for containers such as arrays and collections holding mock objects.

2) We compared and analyzed the performance of Mock analysis on two static analysis framework: Soot and Doop.

3) We conducted an empirical evaluation on a suite of benchmarks, and demonstrated its correctness and discussed its potential applications.